<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Lift  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="Lift  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Lift Docs
        </a>
         (87% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">Lift Reference</a>
      <img class="carat" src="img/carat.png" />
      Lift  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Global Variables.html">Global Variables</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Global Variables.html#/s:4Lift4nullSo6NSNullCv">null</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Bool.html">Bool</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Data.html">Data</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Date.html">Date</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/DateFormatter.html">DateFormatter</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Double.html">Double</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Float.html">Float</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Int.html">Int</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Int16.html">Int16</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Int32.html">Int32</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Int64.html">Int64</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/NSDecimalNumber.html">NSDecimalNumber</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/NSNumber.html">NSNumber</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/NSString.html">NSString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Null.html">Null</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/RawRepresentable.html">RawRepresentable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/String.html">String</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/URL.html">URL</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/UUID.html">UUID</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions/^(_:).html">^(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions/^(_:).html">^(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions/^(_:).html">^(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions/^(_:).html">^(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions/^(_:).html">^(_:)</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Functions/^(_:).html">^(_:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/JarContextValue.html">JarContextValue</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/JarConvertible.html">JarConvertible</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/JarRepresentable.html">JarRepresentable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/JarRepresentableWithContext.html">JarRepresentableWithContext</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/Liftable.html">Liftable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/MutatingValueForKey.html">MutatingValueForKey</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/ValueForKey.html">ValueForKey</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Jar.html">Jar</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Jar/Context.html">– Context</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/LiftError.html">LiftError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:4Lift10JarElementa">JarElement</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Typealiases.html#/s:4Lift4Nulla">Null</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <p align="center">
<img src="lift-logo.png" width="140px" />
</p>

<p><a href="https://travis-ci.org/iZettle/Lift"><img src="https://travis-ci.org/iZettle/Lift.svg?branch=master" alt="Build Status"></a>
<a href="https://img.shields.io/badge/platform-%20iOS%20%7C%20macOS%20%7C%20tvOS%20%7C%20linux-gray.svg"><img src="https://img.shields.io/badge/platform-%20iOS%20%7C%20macOS%20%7C%20tvOS%20%7C%20linux-gray.svg" alt="Plaforms"></a>
<a href="https://github.com/Carthage/Carthage"><img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat" alt="Carthage Compatible"></a>
<a href="https://github.com/apple/swift-package-manager"><img src="https://img.shields.io/badge/SwiftPM-Compatible-brightgreen.svg" alt="Swift Package Manager Compatible"></a></p>

<p>Lift is a Swift library for generating and extracting values into and out of JSON-like data structures. Lift was carefully designed to meet the following requirements:</p>

<ul>
<li>Use easy and intuitive syntax using subscripting.</li>
<li>Be extendable for use with your custom types.</li>
<li>Support of retroactive modeling/conformance.</li>
<li>Don&rsquo;t enforce how to structure your data models.</li>
<li>Be type safe and explicit about errors.</li>
<li>Work with any key value structured data such as p-lists and user defaults.</li>
<li>Provide detailed errors and support custom validation.</li>
<li>Use value semantics for the <code><a href="Structs/Jar.html">Jar</a></code> container.</li>
</ul>
<h3 id='example-usage' class='heading'>Example usage</h3>

<p>Lift is simple, yet powerful. Let&rsquo;s see how to use it with a custom type:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">User</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">let</span> <span class="nv">age</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>
</code></pre>

<p>Just conform to <code><a href="Typealiases.html#/s:4Lift10JarElementa">JarElement</a></code> to let Lift know how to transform your type:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">User</span><span class="p">:</span> <span class="kt">JarElement</span> <span class="p">{</span>
  <span class="nf">init</span><span class="p">(</span><span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="n">name</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span><span class="o">^</span>
    <span class="n">age</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"age"</span><span class="p">]</span><span class="o">^</span>
  <span class="p">}</span>

  <span class="k">var</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="s">"name"</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s">"age"</span><span class="p">:</span> <span class="n">age</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Then given some JSON, you can now construct a <code><a href="Structs/Jar.html">Jar</a></code> and extract users from it using the lift operator <code>^</code>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">json</span> <span class="o">=</span> <span class="s">"[{</span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Adam</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">age</span><span class="se">\"</span><span class="s">: 25}, {</span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Eve</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">age</span><span class="se">\"</span><span class="s">: 20}]"</span>
<span class="k">let</span> <span class="nv">jar</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Jar</span><span class="p">(</span><span class="nv">json</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">users</span><span class="p">:</span> <span class="p">[</span><span class="kt">User</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">^</span>
</code></pre>

<p>And it&rsquo;s as easy to move you model values back to JSON:</p>
<pre class="highlight swift"><code><span class="n">users</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">User</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Junior"</span><span class="p">,</span> <span class="nv">age</span><span class="p">:</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">let</span> <span class="nv">newJson</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">String</span><span class="p">(</span><span class="nv">json</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">(</span><span class="n">users</span><span class="p">),</span> <span class="nv">prettyPrinted</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
</code></pre>

<p>Lift will even work with other JSON-like structured data such as p-lists and <code>UserDefaults</code>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">users</span> <span class="p">[</span><span class="kt">User</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="p">[</span><span class="s">"users"</span><span class="p">]</span><span class="o">^</span>
</code></pre>

<p>Check the <a href="#usage">Usage</a> section for more information and examples.</p>
<h3 id='contents' class='heading'>Contents:</h3>

<ul>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#note-on-codable">Note on <code>Codable</code></a></li>
<li><a href="#usage">Usage</a>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#json-serialization">JSON Serialization</a></li>
<li><a href="#generating-json">Generating JSON</a></li>
<li><a href="#modifiying-json">Modifying JSON</a></li>
<li><a href="#arrays">Arrays</a></li>
<li><a href="#missing-values">Missing values</a></li>
<li><a href="#heterogenuos-values">Heterogenuos values</a></li>
<li><a href="#transformation-of-values">Transformation of values</a></li>
<li><a href="#beyond-json">Beyond JSON</a></li>
<li><a href="#handling-custom-types">Handling custom types</a></li>
<li><a href="#model-structure">Model structure</a></li>
<li><a href="#handling-errors">Handling errors</a></li>
</ul></li>
</ul>
<h2 id='requirements' class='heading'>Requirements</h2>

<ul>
<li>Xcode <code>9.1+</code></li>
<li>Swift 4.0</li>
<li>Platforms:

<ul>
<li>iOS <code>9.0+</code></li>
<li>macOS <code>10.11+</code></li>
<li>tvOS <code>9.0+</code></li>
<li>watchOS <code>2.0+</code></li>
<li>Linux</li>
</ul></li>
</ul>
<h2 id='installation' class='heading'>Installation</h2>
<h4 id='a-href-https-github-com-carthage-carthage-carthage-a' class='heading'><a href="https://github.com/Carthage/Carthage">Carthage</a></h4>
<pre class="highlight shell"><code>github <span class="s2">"iZettle/Lift"</span> &gt;<span class="o">=</span> 1.0
</code></pre>
<h4 id='a-href-https-github-com-cocoapods-cocoapods-cocoa-pods-a' class='heading'><a href="https://github.com/CocoaPods/CocoaPods">Cocoa Pods</a></h4>
<pre class="highlight ruby"><code><span class="n">platform</span> <span class="ss">:ios</span><span class="p">,</span> <span class="s1">'9.0'</span>
<span class="n">use_frameworks!</span>

<span class="n">target</span> <span class="s1">'Your App Target'</span> <span class="k">do</span>
  <span class="n">pod</span> <span class="s1">'Lift'</span><span class="p">,</span> <span class="s1">'~&gt; 1.0'</span>
<span class="k">end</span>
</code></pre>
<h4 id='a-href-https-github-com-apple-swift-package-manager-swift-package-manager-a' class='heading'><a href="https://github.com/apple/swift-package-manager">Swift Package Manager</a></h4>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">PackageDescription</span>

<span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
  <span class="nv">name</span><span class="p">:</span> <span class="s">"Your Package Name"</span><span class="p">,</span>
  <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
      <span class="o">.</span><span class="kt">Package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/iZettle/Lift.git"</span><span class="p">,</span>
               <span class="nv">majorVersion</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">]</span>
<span class="p">)</span>
</code></pre>
<h2 id='note-on-code-codable-code' class='heading'>Note on <code>Codable</code></h2>

<p>Swift 4 introduced <code>Codable</code> with the <q>promise</q> to have solved working with JSON once and for all. And yes, many of the examples shown are just close to magic. But when your models start to diverge from the simple one to one mapping between model and JSON, the magic seems to go away. Now you are back to implement everything yourself and this using a quite verbose API. The current version of Swift also lack APIs for building and parsing JSON on the fly (not going through model objects) which is common when e.g. building and parsing network requests. Hence, we believe the demand for third party JSON libraries will still be there for some time to come.</p>
<h2 id='usage' class='heading'>Usage</h2>
<h3 id='introduction' class='heading'>Introduction</h3>

<p>Let&rsquo;s start out with a simple example of how to extract data from some key value structured data such as JSON:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"Lift"</span><span class="p">,</span> <span class="s">"version"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span><span class="o">^</span>
<span class="k">let</span> <span class="nv">version</span><span class="p">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"version"</span><span class="p">]</span><span class="o">^</span>
</code></pre>

<p><code><a href="Structs/Jar.html">Jar</a></code> is Lift&rsquo;s container of heterogenous values. In this example it holds a dictionary. The operator <code>^</code> (called the lift operator) is used to extract values out of the jar container. Because the jar typically holds values that are not known at compile time, extracting them might fail. This might happen if the value is missing, if the value is not of the expected type, or if some other validation is failing. This is why you will always see a <code>try</code> in the presence of the lift operator <code>^</code>.</p>

<p>As mentioned, JSON does not always come in the form of a dictionary (key-values), but could also be simple primitive types or arrays of other JSON objects:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">i</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Jar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">^</span>
<span class="k">let</span> <span class="nv">b</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Jar</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="o">^</span>
<span class="k">let</span> <span class="nv">a</span><span class="p">:</span> <span class="p">[</span><span class="kt">Int</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Jar</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">^</span>
<span class="k">let</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="s">"value"</span><span class="p">:</span> <span class="s">"lift"</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">s</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"value"</span><span class="p">]</span><span class="o">^</span>
</code></pre>

<p>The <code>^</code> operator is overloaded to allow conforming types to either be extracted as the type itself or as an optional version of it. You can also extract an array or optional array of conforming types:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">i</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">^</span>
<span class="k">let</span> <span class="nv">i</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">^</span>
<span class="k">let</span> <span class="nv">i</span><span class="p">:</span> <span class="p">[</span><span class="kt">Int</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">^</span>
<span class="k">let</span> <span class="nv">i</span><span class="p">:</span> <span class="p">[</span><span class="kt">Int</span><span class="p">]?</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">^</span>
</code></pre>

<p><code><a href="Structs/Jar.html">Jar</a></code> implements subscripting for keys and indices and also allows them to be nested:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"payments"</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="s">"date"</span><span class="p">]</span><span class="o">^</span>
<span class="n">jar</span><span class="p">[</span><span class="s">"payments"</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="s">"date"</span><span class="p">]</span> <span class="o">=</span> <span class="kt">Date</span><span class="p">()</span>
</code></pre>
<h3 id='json-serialization' class='heading'>JSON serialization</h3>

<p>Lift adds convenience initializers to construct a <code><a href="Structs/Jar.html">Jar</a></code> from JSON and back:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">json</span> <span class="o">=</span> <span class="s">"{ </span><span class="se">\"</span><span class="s">val</span><span class="se">\"</span><span class="s">: 3, </span><span class="se">\"</span><span class="s">vals</span><span class="se">\"</span><span class="s">: [ 1, 2 ] }"</span>
<span class="k">let</span> <span class="nv">jar</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Jar</span><span class="p">(</span><span class="nv">json</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">jsonString</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">String</span><span class="p">(</span><span class="nv">json</span><span class="p">:</span> <span class="n">jar</span><span class="p">,</span> <span class="nv">prettyPrinted</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">jsonData</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Data</span><span class="p">(</span><span class="nv">json</span><span class="p">:</span> <span class="n">jar</span><span class="p">,</span> <span class="nv">prettyPrinted</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
</code></pre>

<p>You could also handle the serialization yourself and just pass an <code>Any</code> value:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">json</span><span class="p">:</span> <span class="kt">Any</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">let</span> <span class="nv">jar</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Jar</span><span class="p">(</span><span class="nv">checked</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="c1">// Will validate when constructed - slower</span>
<span class="k">let</span> <span class="nv">jar</span> <span class="o">=</span> <span class="kt">Jar</span><span class="p">(</span><span class="nv">unchecked</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="c1">// Will lazily validate at access - faster</span>

<span class="k">let</span> <span class="nv">any</span><span class="p">:</span> <span class="kt">Any</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">.</span><span class="nf">asAny</span><span class="p">()</span>
</code></pre>
<h3 id='generating-json' class='heading'>Generating JSON</h3>

<p>To help creating JSON, <code><a href="Structs/Jar.html">Jar</a></code> implements several <em>expressible by literal</em> protocols so you can write code like:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="n">_</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="nf">send</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="nf">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nf">send</span><span class="p">(</span><span class="mf">3.14</span><span class="p">)</span>
<span class="nf">send</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">)</span>
<span class="nf">send</span><span class="p">([</span><span class="s">"val"</span><span class="p">:</span> <span class="mi">5</span><span class="p">])</span>
<span class="nf">send</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</code></pre>

<p>When <code><a href="Structs/Jar.html">Jar</a></code> can&rsquo;t be inferred by the complier, you can explicitly specify the type:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="s">"val"</span><span class="p">:</span> <span class="mi">5</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre>

<p>When building nested hierarchies you have to cast nested non-primitive values<sup id="a1"><a href="#f1">1</a></sup>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="s">"val"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Jar</span><span class="p">]</span> <span class="k">as</span> <span class="kt">Jar</span><span class="p">]</span> <span class="c1">// Use either `as`</span>
<span class="k">let</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="kt">Jar</span><span class="p">([</span><span class="s">"val"</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])])]</span> <span class="c1">// or Jar(...)</span>
</code></pre>

<p>And of course you can also build JSON from your custom types:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="s">"payment"</span><span class="p">:</span> <span class="n">payment</span><span class="p">,</span> <span class="s">"date"</span><span class="p">:</span> <span class="n">date</span><span class="p">]</span>
</code></pre>
<h3 id='modifying-json' class='heading'>Modifying JSON</h3>

<p>Because <code><a href="Structs/Jar.html">Jar</a></code> is a value type with value semantics, you can modify your <code><a href="Structs/Jar.html">Jar</a></code> value when declared as <code>var</code>.</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">jar</span> <span class="o">=</span> <span class="kt">Jar</span><span class="p">()</span>
<span class="n">jar</span><span class="p">[</span><span class="s">"payment"</span><span class="p">]</span> <span class="o">=</span> <span class="n">payment</span>
<span class="n">jar</span><span class="p">[</span><span class="s">"date"</span><span class="p">]</span> <span class="o">=</span> <span class="kt">Date</span><span class="p">()</span>
</code></pre>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">jar</span> <span class="o">=</span> <span class="kt">Jar</span><span class="p">()</span>
<span class="n">jar</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">payment</span><span class="p">)</span>
<span class="n">jar</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">Date</span><span class="p">())</span>
</code></pre>

<p>And if you need to modify your JSON before passing it on just make a copy:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">jar</span> <span class="o">=</span> <span class="n">jar</span>
  <span class="n">jar</span><span class="p">[</span><span class="s">"timeReceived"</span><span class="p">]</span> <span class="o">=</span> <span class="kt">Date</span><span class="p">()</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre>

<p>A <code><a href="Structs/Jar.html">Jar</a></code> is never bound to a specific type or value, hence it is always ok to change it:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">// jar holds a boolean</span>
<span class="n">jar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1">// holds an array</span>
<span class="n">jar</span><span class="p">[</span><span class="s">"val"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">// holds a dictionary</span>
<span class="n">jar</span> <span class="o">=</span> <span class="mi">4711</span> <span class="c1">// holds an integer</span>
<span class="n">jar</span> <span class="o">=</span> <span class="p">[</span><span class="s">"val2"</span><span class="p">:</span> <span class="mi">2</span><span class="p">]</span> <span class="c1">// holds a dictionary</span>
<span class="n">jar</span> <span class="o">=</span> <span class="s">"Hello"</span> <span class="c1">// holds a string</span>
</code></pre>
<h3 id='arrays' class='heading'>Arrays</h3>

<p>Lift supports working with arrays of primitive types:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">jar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">jar</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">val</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">^</span>
</code></pre>

<p>As well as arrays of your custom types:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="kt">Payment</span><span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="kt">Payment</span><span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="o">...</span><span class="p">]</span>

<span class="k">let</span> <span class="nv">payments</span><span class="p">:</span> <span class="p">[</span><span class="kt">Payment</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">^</span>
<span class="n">jar</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kt">Payment</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre>
<h3 id='missing-values-and-json-null' class='heading'>Missing values and JSON null</h3>

<p>Sometimes the existence of a value is a requirement, sometimes it is optional.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">i</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"val"</span><span class="p">]</span><span class="o">^</span> <span class="c1">// Will throw if val is missing or not an Int</span>
<span class="k">let</span> <span class="nv">i</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"val"</span><span class="p">]</span><span class="o">^</span> <span class="c1">// Will return nil if val is missing or null, else throw if not an Int</span>
<span class="k">let</span> <span class="nv">i</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"val"</span><span class="p">]</span><span class="o">^</span> <span class="p">??</span> <span class="mi">4711</span> <span class="c1">// Will throw if val is present and is not an Int</span>
</code></pre>

<p>For your convenience Lift treats a value set to JSON null the same as a missing value. But if you need to check for the presence of the actual null value itself you can write:</p>
<pre class="highlight swift"><code><span class="k">if</span> <span class="k">let</span> <span class="nv">_</span><span class="p">:</span> <span class="kt">Null</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">jar</span><span class="p">[</span><span class="s">"val"</span><span class="p">]</span><span class="o">^</span> <span class="p">{</span>
  <span class="c1">//...</span>
<span class="p">}</span>
</code></pre>

<p>When building your JSON it is quite common that some values are optional:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">optional</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="k">var</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="s">"val"</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">jar</span><span class="p">[</span><span class="s">"optional"</span><span class="p">]</span> <span class="o">=</span> <span class="kd">optional</span> <span class="c1">// -&gt; {"val": 1}</span>
</code></pre>

<p>It is also possible to add your optional inline<sup id="a1"><a href="#f1">1</a></sup>:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="s">"val"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"optional"</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">(</span><span class="kd">optional</span><span class="p">)]</span> <span class="c1">// -&gt; {"val": 1}</span>
</code></pre>

<p>If you actually want a JSON null value you can use the constant <code><a href="Global Variables.html#/s:4Lift4nullSo6NSNullCv">null</a></code>:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="s">"val"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"optional"</span><span class="p">:</span> <span class="kd">optional</span> <span class="p">??</span> <span class="n">null</span><span class="p">]</span> <span class="c1">// -&gt; {"val": 1, "optional": null}</span>
</code></pre>
<h3 id='heterogenous-values' class='heading'>Heterogenous values</h3>

<p>Sometimes parts of your JSON could hold the union of different kinds of valid types. Then you could test between the different variations you support:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">any</span><span class="p">:</span> <span class="kt">Any</span><span class="p">?</span> <span class="o">=</span> <span class="kt">NSJSONSerialization</span><span class="o">...</span>
<span class="k">let</span> <span class="nv">jar</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Jar</span><span class="p">(</span><span class="n">any</span><span class="p">)</span> <span class="c1">// any could be a dictionary, array or a primitive type</span>

<span class="k">if</span> <span class="k">let</span> <span class="nv">int</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">jar</span><span class="o">^</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">ints</span><span class="p">:</span> <span class="p">[</span><span class="kt">Int</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">jar</span><span class="o">^</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">int</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">jar</span><span class="p">[</span><span class="s">"value"</span><span class="p">]</span><span class="o">^</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre>

<p>JSON also supports arrays of mixed types:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">jar</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">Jar</span><span class="p">(</span><span class="n">any</span><span class="p">)</span> <span class="c1">// [ 1, [1, 2], { "val" : 3 } ] -- [Int, Array, Dictionary]</span>

<span class="k">let</span> <span class="nv">int</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">^</span>
<span class="k">let</span> <span class="nv">array</span><span class="p">:</span> <span class="p">[</span><span class="kt">Int</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span>
<span class="k">let</span> <span class="nv">dict</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">^</span>
</code></pre>
<h3 id='transformation-of-values' class='heading'>Transformation of values</h3>

<p>You sometimes need to transform the values extracted from a <code><a href="Structs/Jar.html">Jar</a></code> before using it. This might happen when you are working with types that cannot conform to <code><a href="Protocols/JarRepresentable.html">JarRepresentable</a></code>, such as when using tuples:</p>
<pre class="highlight swift"><code><span class="kd">typealias</span> <span class="kt">User</span> <span class="o">=</span> <span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">age</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">users</span><span class="p">:</span> <span class="p">[</span><span class="kt">User</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="p">(</span><span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">)</span> <span class="k">in</span> <span class="nf">try</span> <span class="p">(</span><span class="n">jar</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span><span class="o">^</span><span class="p">,</span> <span class="n">jar</span><span class="p">[</span><span class="s">"age"</span><span class="p">]</span><span class="o">^</span><span class="p">)</span> <span class="p">}</span>
</code></pre>

<p>Or when your type does not conform to <code><a href="Protocols/JarRepresentable.html">JarRepresentable</a></code>, as it might need some additional initialization data:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">account</span><span class="p">:</span> <span class="kt">Account</span> <span class="o">=</span> <span class="o">...</span>

<span class="k">let</span> <span class="nv">payments</span><span class="p">:</span> <span class="p">[</span><span class="kt">Payment</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"payments"</span><span class="p">]</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">jar</span> <span class="k">in</span>
  <span class="kt">Payment</span><span class="p">(</span><span class="nv">jar</span><span class="p">:</span> <span class="n">jar</span><span class="p">,</span> <span class="nv">account</span><span class="p">:</span> <span class="n">account</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Even though you can use <code>map</code> for additional initialization data, often it is more convenient to add this data to the jar&rsquo;s context instead. Jar contexts will be described further down.</p>
<h3 id='beyond-json' class='heading'>Beyond JSON</h3>

<p>Setting and getting values of unknown types is not unique to JSON. Many Cocoa APIs use dictionaries and many of them are based on similar principles as JSON, such as p-lists. Lift provides protocols for extending these types to be able to access the power of Lift. E.g. Lift already extends UserDefaults:</p>
<pre class="highlight swift"><code><span class="c1">// extension UserDefaults: MutatingValueForKey { }</span>

<span class="k">let</span> <span class="nv">userDefaults</span> <span class="o">=</span> <span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span>

<span class="k">let</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span><span class="p">?</span> <span class="o">=</span> <span class="k">try</span> <span class="n">userDefaults</span><span class="p">[</span><span class="s">"lastLaunched"</span><span class="p">]</span><span class="o">^</span>
<span class="n">userDefaults</span><span class="p">[</span><span class="s">"lastLaunched"</span><span class="p">]</span> <span class="o">=</span> <span class="kt">Date</span><span class="p">()</span>

<span class="k">let</span> <span class="nv">payments</span><span class="p">:</span> <span class="p">[</span><span class="kt">Payments</span><span class="p">]</span> <span class="o">=</span> <span class="k">try</span> <span class="n">userDefaults</span><span class="p">[</span><span class="s">"payments"</span><span class="p">]</span><span class="o">^</span> <span class="p">??</span> <span class="p">[]</span>
</code></pre>
<h3 id='jarconvertible-amp-jarrepresentable' class='heading'>JarConvertible &amp; JarRepresentable</h3>

<p>Out of the box, the Lift library supports JSON dictionaries, arrays and its primitive types: string, number, bool and null. But it&rsquo;s easy to extend your own types to work with the Lift library as well.</p>

<p>To be able extract values out of a <code><a href="Structs/Jar.html">Jar</a></code> using the lift operator <code>^</code>, you conform your type to the <code><a href="Protocols/JarConvertible.html">JarConvertible</a></code> protocol:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">JarConvertible</span> <span class="p">{</span>
  <span class="nf">init</span><span class="p">(</span><span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">)</span> <span class="k">throws</span>
<span class="p">}</span>
</code></pre>

<p>And to be able to convert your type to a <code><a href="Structs/Jar.html">Jar</a></code>, you conform your type to <code><a href="Protocols/JarRepresentable.html">JarRepresentable</a></code>:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">JarRepresentable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>It is common we want to implement both these protocols hence the convenience <code><a href="Typealiases.html#/s:4Lift10JarElementa">JarElement</a></code> type alias:</p>
<pre class="highlight swift"><code><span class="kd">typealias</span> <span class="kt">JarElement</span> <span class="o">=</span> <span class="kt">JarConvertible</span> <span class="o">&amp;</span> <span class="kt">JarRepresentable</span>
</code></pre>

<p>The Lift library includes extensions for the most common primitive types such as <code>Int</code>, <code>Bool</code>, <code>String</code>, etc., by conforming them to <code><a href="Typealiases.html#/s:4Lift10JarElementa">JarElement</a></code>.</p>
<h3 id='handling-custom-types' class='heading'>Handling custom types</h3>

<p>Your custom types are typically either simple types such as:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Money</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">fractionized</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Money</span><span class="p">:</span> <span class="kt">JarElement</span> <span class="p">{</span>
  <span class="nf">init</span><span class="p">(</span><span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="n">fractionized</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">^</span>
  <span class="p">}</span>

  <span class="k">var</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="p">{</span> <span class="k">return</span> <span class="kt">Jar</span><span class="p">(</span><span class="n">fractionized</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="s">"amount"</span><span class="p">:</span> <span class="kt">Money</span><span class="p">(</span><span class="nv">fractionized</span><span class="p">:</span> <span class="mi">2000</span><span class="p">)]</span>
<span class="k">let</span> <span class="nv">amount</span><span class="p">:</span> <span class="kt">Money</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"amount"</span><span class="p">]</span><span class="o">^</span>
</code></pre>

<p>Or perhaps more common, more complex and record like types such as:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Payment</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">amount</span><span class="p">:</span> <span class="kt">Money</span>
  <span class="k">let</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Payment</span><span class="p">:</span> <span class="kt">JarElement</span> <span class="p">{</span>
  <span class="nf">init</span><span class="p">(</span><span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"amount"</span><span class="p">]</span><span class="o">^</span>
    <span class="n">date</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"date"</span><span class="p">]</span><span class="o">^</span>
  <span class="p">}</span>

  <span class="k">var</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="s">"amount"</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span> <span class="s">"date"</span><span class="p">:</span> <span class="n">date</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="s">"payment"</span><span class="p">:</span> <span class="kt">Payment</span><span class="p">(</span><span class="o">...</span><span class="p">)]</span>
<span class="k">let</span> <span class="nv">payment</span><span class="p">:</span> <span class="kt">Payment</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"payment"</span><span class="p">]</span><span class="o">^</span>
</code></pre>

<p>To make it easier to conform your custom enums with raw values, Lift comes with some default implementations. All you have to do is to conform the enum to <code><a href="Typealiases.html#/s:4Lift10JarElementa">JarElement</a></code> to be able to use it with <code><a href="Structs/Jar.html">Jar</a></code>s:</p>
<pre class="highlight swift"><code><span class="kd">enum</span> <span class="kt">MyEnum</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">JarElement</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">,</span> <span class="n">three</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="s">"enum"</span><span class="p">:</span> <span class="kt">MyEnum</span><span class="o">.</span><span class="n">two</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">str</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"enum"</span><span class="p">]</span><span class="o">^</span> <span class="c1">// -&gt; "two"</span>
<span class="k">let</span> <span class="nv">myEnum</span><span class="p">:</span> <span class="kt">MyEnum</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"enum"</span><span class="p">]</span><span class="o">^</span> <span class="c1">// -&gt; .two</span>
</code></pre>

<p>If your type is a non-final class you can&rsquo;t retroactively conform it to <code><a href="Protocols/JarConvertible.html">JarConvertible</a></code> as it requires you to implement a required init. Instead you have to use the <code><a href="Protocols/Liftable.html">Liftable</a></code> protocol:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">MyClass</span><span class="p">:</span> <span class="kt">Liftable</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="kd">func</span> <span class="nf">lift</span><span class="p">(</span><span class="n">from</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">MyClass</span> <span class="p">{</span>
    <span class="c1">// Implementation</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='model-structure' class='heading'>Model structure</h3>

<p>The Lift library does not enforce the structure of you custom types and also allows retroactive modeling. It is up to you how you decide to map between your types and JSON. For example you might have enums with associative values (in this example a recursive one):</p>
<pre class="highlight swift"><code><span class="c1">// [ { "type": "Product", "uuid": ”3b0bb980-2c…” },</span>
<span class="c1">//   { "type": "Folder", "name": "Coffee", "items": [</span>
<span class="c1">//        { "type": "Product", "uuid": ”3e493140-2c…” },</span>
<span class="c1">//        { "type": "Product", ”uuid": ”3e623780-2c…” }] },</span>
<span class="c1">//   ... ]</span>

<span class="kd">indirect</span> <span class="kd">enum</span> <span class="kt">FlowLayout</span> <span class="p">{</span>
  <span class="k">case</span> <span class="nf">product</span><span class="p">(</span><span class="nv">uuid</span><span class="p">:</span> <span class="kt">UUID</span><span class="p">)</span>
  <span class="k">case</span> <span class="nf">folder</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">items</span><span class="p">:</span> <span class="p">[</span><span class="kt">FlowLayout</span><span class="p">])</span>
<span class="p">}</span>
</code></pre>

<p>Because the JSON format has a weaker type-system than Swift, stricter validation becomes more important:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">FlowLayout</span><span class="p">:</span> <span class="kt">JarConvertible</span>  <span class="p">{</span>
  <span class="nf">init</span><span class="p">(</span><span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"type"</span><span class="p">]</span><span class="o">^</span> <span class="k">as</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s">"Product"</span><span class="p">:</span>
      <span class="k">self</span> <span class="o">=</span> <span class="k">try</span> <span class="o">.</span><span class="nf">product</span><span class="p">(</span><span class="nv">uuid</span><span class="p">:</span> <span class="n">jar</span><span class="p">[</span><span class="s">"uuid"</span><span class="p">]</span><span class="o">^</span><span class="p">)</span>
    <span class="k">case</span> <span class="s">"Folder"</span><span class="p">:</span>
      <span class="k">self</span> <span class="o">=</span> <span class="k">try</span> <span class="o">.</span><span class="nf">folder</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="n">jar</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span><span class="o">^</span><span class="p">,</span> <span class="nv">items</span><span class="p">:</span> <span class="n">jar</span><span class="p">[</span><span class="s">"items"</span><span class="p">]</span><span class="o">^</span><span class="p">)</span>
    <span class="k">case</span> <span class="k">let</span> <span class="nv">type</span><span class="p">:</span>
      <span class="k">throw</span> <span class="n">jar</span><span class="o">.</span><span class="nf">assertionFailure</span><span class="p">(</span><span class="s">"Unknown layout type: </span><span class="se">\(</span><span class="n">type</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Even for these more complex types, generation of JSON is still quite straightforward:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">FlowLayout</span><span class="p">:</span> <span class="kt">JarRepresentable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="p">{</span>
      <span class="k">switch</span> <span class="k">self</span> <span class="p">{</span>
      <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">product</span><span class="p">(</span><span class="n">uuid</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">"type"</span><span class="p">:</span> <span class="s">"Product"</span><span class="p">,</span> <span class="s">"uuid"</span><span class="p">:</span> <span class="n">uuid</span><span class="p">]</span>
      <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">folder</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">"type"</span><span class="p">:</span> <span class="s">"Folder"</span><span class="p">,</span> <span class="s">"name"</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s">"items"</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">(</span><span class="n">items</span><span class="p">)]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='handling-errors' class='heading'>Handling errors</h3>

<p>Because JSON is typically nested, it is useful to extend errors with some positioning and context. Lift tries to keep track of the closest context and <q>key-path</q> into your data and will expose those in <code><a href="Structs/LiftError.html">LiftError</a></code>s:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">LiftError</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">description</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">let</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">let</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
</code></pre>

<p>Because the context and key-path are really valuable during debugging, it&rsquo;s important to not lose those when throwing validation errors. Hence, Lift has added assert helper methods to <code><a href="Structs/Jar.html">Jar</a></code> that you should use:</p>
<pre class="highlight swift"><code><span class="nf">init</span><span class="p">(</span><span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="k">try</span> <span class="n">jar</span><span class="o">.</span><span class="nf">assert</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"Must greater than zero"</span><span class="p">)</span>

  <span class="k">guard</span> <span class="nf">validate</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="n">jar</span><span class="o">.</span><span class="nf">assertionFailure</span><span class="p">(</span><span class="s">"Not a business nor a person"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="n">url</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">.</span><span class="nf">assertNotNil</span><span class="p">(</span><span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">jar</span><span class="o">^</span><span class="p">),</span> <span class="s">"Invalid URL"</span><span class="p">)</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre>
<h3 id='jar-context' class='heading'>Jar context</h3>

<p>Sometimes your type&rsquo;s initializer needs access to more data than what is included in the JSON itself. E.g. perhaps your <code>Money</code> type needs a currency as well, but your JSON does not provide that or provides it far away from the actual amount value itself. This is where you can pass the currency in the jar&rsquo;s context instead:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Money</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">fractionized</span><span class="p">:</span> <span class="kt">Int</span>
  <span class="k">let</span> <span class="nv">currency</span><span class="p">:</span> <span class="kt">Currency</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Money</span><span class="p">:</span> <span class="kt">JarElement</span> <span class="p">{</span>
  <span class="nf">init</span><span class="p">(</span><span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="n">fractionized</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">^</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="nf">get</span><span class="p">()</span> <span class="c1">// will extract the currency</span>
  <span class="p">}</span>

  <span class="k">var</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="p">{</span> <span class="k">return</span> <span class="kt">Jar</span><span class="p">(</span><span class="n">fractionized</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">amount</span><span class="p">:</span> <span class="kt">Money</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">.</span><span class="nf">union</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="n">currency</span><span class="p">)[</span><span class="s">"amount"</span><span class="p">]</span><span class="o">^</span>
</code></pre>

<p>The jar&rsquo;s context is also useful for customizing the encoding and decoding of your types. E.g. <code>Date</code> will by default use the ISO8601 date format, but by providing another <code>DateFormatter</code> in the jar&rsquo;s context you could customize the date format:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">Date</span><span class="p">:</span> <span class="kt">JarConvertible</span><span class="p">,</span> <span class="kt">JarRepresentableWithContext</span> <span class="p">{</span>
  <span class="nf">init</span><span class="p">(</span><span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">formatter</span><span class="p">:</span> <span class="kt">DateFormatter</span> <span class="o">=</span> <span class="n">jar</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="nf">get</span><span class="p">()</span> <span class="p">??</span> <span class="o">.</span><span class="n">iso8601</span>
    <span class="k">self</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">.</span><span class="nf">assertNotNil</span><span class="p">(</span><span class="n">formatter</span><span class="o">.</span><span class="nf">date</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">jar</span><span class="o">^</span><span class="p">),</span> <span class="s">"Date failed to convert using formatter with dateFormat: </span><span class="se">\(</span><span class="n">formatter</span><span class="o">.</span><span class="n">dateFormat</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="kd">func</span> <span class="nf">asJar</span><span class="p">(</span><span class="n">using</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">Jar</span><span class="o">.</span><span class="kt">Context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Jar</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">formatter</span><span class="p">:</span> <span class="kt">DateFormatter</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="nf">get</span><span class="p">()</span> <span class="p">??</span> <span class="o">.</span><span class="n">iso8601</span>
    <span class="k">return</span> <span class="kt">Jar</span><span class="p">(</span><span class="n">formatter</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="k">self</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>As <code><a href="Protocols/JarRepresentable.html">JarRepresentable</a></code> does not provide any context, you will instead conform to <code><a href="Protocols/JarRepresentableWithContext.html">JarRepresentableWithContext</a></code> that passes the context in <code>asJar</code>:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">JarRepresentableWithContext</span><span class="p">:</span> <span class="kt">JarRepresentable</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">asJar</span><span class="p">(</span><span class="n">using</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">Jar</span><span class="o">.</span><span class="kt">Context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Jar</span>
<span class="p">}</span>
</code></pre>

<p>The context could either be set externally or as part of some other type&rsquo;s encoding/decoding such as:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Payment</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">amount</span><span class="p">:</span> <span class="kt">Money</span>
  <span class="k">let</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Payment</span><span class="p">:</span> <span class="kt">JarElement</span> <span class="p">{</span>
  <span class="nf">init</span><span class="p">(</span><span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">jar</span> <span class="o">=</span> <span class="n">jar</span><span class="o">.</span><span class="nf">union</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">DateFormatter</span><span class="o">.</span><span class="n">custom</span><span class="p">)</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"amount"</span><span class="p">]</span><span class="o">^</span> <span class="c1">// a currency must be provided in the jar's context</span>
    <span class="n">date</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="p">[</span><span class="s">"date"</span><span class="p">]</span><span class="o">^</span> <span class="c1">// date will format using DateFormatter.custom</span>
  <span class="p">}</span>

  <span class="k">var</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">jar</span><span class="p">:</span> <span class="kt">Jar</span> <span class="o">=</span> <span class="p">[</span><span class="s">"amount"</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span> <span class="s">"date"</span><span class="p">:</span> <span class="n">date</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">jar</span><span class="o">.</span><span class="nf">union</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">DateFormatter</span><span class="o">.</span><span class="n">custom</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">payment</span><span class="p">:</span> <span class="kt">Payment</span> <span class="o">=</span> <span class="k">try</span> <span class="n">jar</span><span class="o">.</span><span class="nf">union</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="n">currency</span><span class="p">)[</span><span class="s">"payment"</span><span class="p">]</span><span class="o">^</span>
</code></pre>

<p><hr></p>

<p><b id="f1">1</b> Currently arrays and optionals requires an explicit casting due to compiler limitations. When Swift adds support for conditional conformances this work-around should no longer be necessary. <a href="#a1">↩</a></p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2017 <a class="link" href="https://github.com/iZettle/Lift" target="_blank" rel="external">iZettle AB</a>. All rights reserved. (Last updated: 2017-12-08)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.0</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
